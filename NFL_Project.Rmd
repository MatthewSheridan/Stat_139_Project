---
title: "R Notebook"
output: pdf_document
---


```{r}
install.packages("tidyverse", type = "binary")
install.packages("ggrepel", type = "binary")
install.packages("ggimage", type = "binary")
install.packages("nflfastR", type = "binary")
```

```{r}
library(tidyverse)
library(ggrepel)
library(ggimage)
library(nflfastR)
options(scipen = 9999)
```

```{r}
cleaned = data.frame()
data <- load_pbp(2020)

sum(data[data$posteam == "NE" & data$pass==1,]$yards_gained)
data[(data$posteam == "NE"),]$home_score

        
        
for (i in unique(data$game_id)){
  home = data[data$game_id == i,]$home_team
  away = data[data$game_id == i,]$away_team
  #home_data = c(sum(data[data$posteam == home & data$pass==1,]$yards_gained, na.rm=T))
  print((sum(data[data$game_id == i & data$posteam == home & data$pass==1,]$yards_gained, na.rm=T)))
}
#252

data[data$game_id=="2020091311" & data$posteam==data$home_team & data$pass==1, ]

unique(data$extra_point_result)
```


```{r}
data1 <- load_pbp(2019)
#head(data1$game_id,100)

#unique(data1$game_id)

names = c("Game_id","Home","Team_Name","TFL", "QB_Hit", "Pass_Yrd","Rush_Yrd",
          "TD","FG_attempt","XP_missed","FG_missed","FUM","INT","4th_Dwn_Con","3rd_Dwn_Con","Pen")

df <- data.frame()

for(i in unique(data1$game_id)) {
  temp <- subset(data1, game_id == i)
  for(j in c(temp$home_team[1], temp$away_team[1])) {
    to_add <- c(i, #Game id
                j==temp$home_team[1], #team is home
                j, #team name
                sum(temp$tackled_for_loss[temp$defteam == j] == 1, na.rm=TRUE), #tackles for loss
                sum(temp$qb_hit[temp$posteam == j] == 1, na.rm=TRUE), #how many times team's QB was hit
                sum(temp$passing_yards[temp$posteam == j], na.rm=TRUE), #team passing yards
                sum(temp$rushing_yards[temp$posteam == j], na.rm=TRUE), #team rushing yards
                sum(temp$touchdown[temp$posteam == j], na.rm=TRUE), #team touchdowns
                sum(temp$field_goal_attempt[temp$posteam == j], na.rm=TRUE), #team field goal attempts
                sum(temp$extra_point_result[temp$posteam == j]=="failed" | 
                      temp$extra_point_result[temp$posteam == j]=="blocked", na.rm=TRUE), #exp missed
                sum(temp$field_goal_result[temp$posteam == j]=="missed" | 
                      temp$field_goal_result[temp$posteam == j]=="blocked", na.rm=TRUE), #fg missed
                sum(temp$fumble[temp$defteam == j], na.rm=TRUE), #number of fumbles
                sum(temp$interception[temp$defteam == j], na.rm=TRUE), #number of interceptions
                sum(temp$fourth_down_converted[temp$posteam == j], na.rm=TRUE), #4th down conversions
                sum(temp$third_down_converted[temp$posteam == j], na.rm=TRUE), #3rd down conversions
                sum(temp$penalty[temp$posteam == j & temp$penalty_team == j], na.rm=TRUE) #number of penalties
                )
    df <- rbind(df, to_add)
  }
}

colnames(df) = names

df

```